@{
    ViewBag.Title = "Available Quizzes - Quizzyfy";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    body {
        background: linear-gradient(135deg, #0f0f0f, #1a1a1a, #2c2c2c);
        color: #fff;
    }

    .card {
        background: rgba(20,20,20,0.95);
        border: 1px solid #333;
        border-radius: 10px;
        margin-bottom: 15px;
        padding: 15px;
    }

    .btn-primary {
        background: linear-gradient(90deg, #ff6a00, #ee0979);
        border: none;
    }
</style>

<div class="container my-5">
    <h2 class="text-center mb-4">Available Quizzes</h2>

    <ul class="list-group" id="quizList">
       
    </ul>
</div>

<script>
    document.addEventListener("DOMContentLoaded", async () => {
        const token = localStorage.getItem("token");

        if (!token) {
            alert("Please login first!");
            window.location.href = "/Account/Login";
            return;
        }

        try {
            const res = await fetch("/api/QuizApi/all", { 
                headers: { "Authorization": `Bearer ${token}` }
            });

            if (res.status === 401) {
                alert("Unauthorized! Please login again.");
                window.location.href = "/Account/Login";
                return;
            }

            const quizzes = await res.json();
            const container = document.getElementById("quizList");

            if (!quizzes.length) {
                container.innerHTML = `<li class="list-group-item text-center">No quizzes available.</li>`;
                return;
            }

            quizzes.forEach(q => {
                const li = document.createElement("li");
                li.className = "list-group-item card";
                li.innerHTML = `
                        <h4 style="color: white;">${q.title}</h4>
                         <p style="color: white;">${q.description}</p>

                    <a href="/TakeQuiz/Start?quizId=${q.quizId}" class="btn btn-primary">Take Quiz</a>
                `;
                container.appendChild(li);
            });

        } catch (err) {
            console.error(err);
            alert("Error loading quizzes. Please try again later.");
        }
    });
</script>
